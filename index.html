<!doctype html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />













<script>
  (function(){
    if (''){
      if (prompt('Please input reading password','') !== ''){
        alert('error password.');
        history.back();
        }
    }
  })();
</script>



  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Klpek's Note Library">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Klpek's Note Library">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Klpek's Note Library">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Klpek's Note Library </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Klpek's Note Library</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/07/evaluation-measure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Klpek">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klpek's Note Library">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/07/evaluation-measure/" itemprop="url">
                  evaluation-measure
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-07T11:26:27+08:00">
                2017-09-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/07/evaluation-measure/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/09/07/evaluation-measure/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="分类问题"><a href="#分类问题" class="headerlink" title="分类问题"></a>分类问题</h3><h4 id="precision-精确率"><a href="#precision-精确率" class="headerlink" title="precision(精确率)"></a>precision(精确率)</h4><script type="math/tex; mode=display">P = \frac{TP}{TP+FP} \tag{1}</script><h4 id="recall-召回率"><a href="#recall-召回率" class="headerlink" title="recall(召回率)"></a>recall(召回率)</h4><script type="math/tex; mode=display">R = \frac{TP}{TP+FN} \tag{2}</script><h4 id="F-1"><a href="#F-1" class="headerlink" title="$F_1$"></a>$F_1$</h4><p>精确率和召回率的调和均值，</p>
<script type="math/tex; mode=display">
\begin{align*}
\frac{2}{F_1} & = \frac{1}{P} + \frac{1}{R}\\
F_1 & = \frac{2TP}{2TP + FP + FN} \tag{3}
\end{align*}</script><p>精确率和准确率都高的情况下，$F_1$值也会高。</p>
<h3 id="later"><a href="#later" class="headerlink" title="later"></a>later</h3><p><a href="http://charleshm.github.io/2016/03/Model-Performance/" target="_blank" rel="external">http://charleshm.github.io/2016/03/Model-Performance/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/01/Alignment_Quality_Evaluation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Klpek">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klpek's Note Library">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/01/Alignment_Quality_Evaluation/" itemprop="url">
                  Untitled
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-01T17:21:36+08:00">
                2017-09-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/01/Alignment_Quality_Evaluation/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/09/01/Alignment_Quality_Evaluation/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="sequences-alignment-tools"><a href="#sequences-alignment-tools" class="headerlink" title="sequences alignment tools"></a>sequences alignment tools</h2><h3 id="BLAST"><a href="#BLAST" class="headerlink" title="BLAST"></a>BLAST</h3><p>sequence-sequence alignment</p>
<h3 id="PSI-BLAST"><a href="#PSI-BLAST" class="headerlink" title="PSI-BLAST"></a>PSI-BLAST</h3><p>profile-sequence alignment</p>
<h3 id="HMMER"><a href="#HMMER" class="headerlink" title="HMMER"></a>HMMER</h3><p>HMM-sequence alignment</p>
<h3 id="PROF-SIM-and-COMPASS"><a href="#PROF-SIM-and-COMPASS" class="headerlink" title="PROF_SIM and COMPASS"></a>PROF_SIM and COMPASS</h3><p>profile-profile alignment</p>
<h3 id="HHSearch"><a href="#HHSearch" class="headerlink" title="HHSearch"></a>HHSearch</h3><h5 id="HHSearch2"><a href="#HHSearch2" class="headerlink" title="HHSearch2"></a>HHSearch2</h5><h2 id="Alignment-Quality-Evaluation"><a href="#Alignment-Quality-Evaluation" class="headerlink" title="Alignment Quality Evaluation"></a>Alignment Quality Evaluation</h2><h3 id="plain-MaxSub-score"><a href="#plain-MaxSub-score" class="headerlink" title="plain MaxSub score"></a>plain MaxSub score</h3><script type="math/tex; mode=display">S_{Dev}=N_{correct}/min(L_q,L_p)</script><h3 id="Modeler’s-score"><a href="#Modeler’s-score" class="headerlink" title="Modeler’s score"></a>Modeler’s score</h3><script type="math/tex; mode=display">S_{Mod}=N_{correct}/L_{ali}</script><h3 id="Balanced-Score"><a href="#Balanced-Score" class="headerlink" title="Balanced Score"></a>Balanced Score</h3><script type="math/tex; mode=display">S_{balanced}=(S_{Dev}+S_{Mod})</script>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/27/tf_train/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Klpek">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klpek's Note Library">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/27/tf_train/" itemprop="url">
                  Untitled
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-27T16:07:06+08:00">
                2017-08-27
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/27/tf_train/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/27/tf_train/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>MonitoredSession<br><a href="https://www.tensorflow.org/api_docs/python/tf/train/MonitoredSession" target="_blank" rel="external">https://www.tensorflow.org/api_docs/python/tf/train/MonitoredSession</a><br>hook</p>
<h3 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h3><p><a href="https://www.tensorflow.org/api_docs/python/tf/contrib/learn/Experiment" target="_blank" rel="external">https://www.tensorflow.org/api_docs/python/tf/contrib/learn/Experiment</a><br>Experiment is a class containing all information needed to train a model.<br>by passing an Estimator and inputs for training and evaluation, an Experiment instance knows how to invoke training and eval loops in a sensible fashion for distributed training.</p>
<h4 id="method"><a href="#method" class="headerlink" title="method"></a>method</h4><h5 id="Constructor"><a href="#Constructor" class="headerlink" title="Constructor"></a>Constructor</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">__init__(</div><div class="line">    estimator,</div><div class="line">    train_input_fn,</div><div class="line">    eval_input_fn,</div><div class="line">    eval_metrics=<span class="keyword">None</span>,</div><div class="line">    train_steps=<span class="keyword">None</span>,</div><div class="line">    eval_steps=<span class="number">100</span>,</div><div class="line">    train_monitors=<span class="keyword">None</span>,</div><div class="line">    eval_hooks=<span class="keyword">None</span>,</div><div class="line">    local_eval_frequency=<span class="keyword">None</span>,</div><div class="line">    eval_delay_secs=<span class="number">120</span>,</div><div class="line">    continuous_eval_throttle_secs=<span class="number">60</span>,</div><div class="line">    min_eval_frequency=<span class="keyword">None</span>,</div><div class="line">    delay_workers_by_global_step=<span class="keyword">False</span>,</div><div class="line">    export_strategies=<span class="keyword">None</span>,</div><div class="line">    train_steps_per_iteration=<span class="keyword">None</span></div><div class="line">)</div></pre></td></tr></table></figure>
<p>Creates an Experiment instance.<br>None of the functions passed to this constructor are executed at construction time.<br>They are stored and used when a method is executed which requires it.</p>
<ul>
<li>estimator<ul>
<li>Object implementing Estimator interface,</li>
</ul>
</li>
<li>train_input_fn<ul>
<li>function, returns features and labels for training.</li>
</ul>
</li>
<li>eval_input_fn<ul>
<li>function, returns features and labels for evaluation.</li>
<li>If eval_steps is None, this should be configured only to produce for a finite number of batches (generally, 1 epoch over the evaluation data).</li>
</ul>
</li>
<li>eval_metrics<ul>
<li>dict of string, metric function.</li>
<li>If None, default set is used. This should be None if the estimator is ${tf.estimator.Estimator}$. If metrics are provided they will be appended to the default set.</li>
</ul>
</li>
<li>train_steps<ul>
<li>Perform this many steps of training. None, the default, means train forever.</li>
</ul>
</li>
<li>eval_steps<ul>
<li>evaluate runs until input is exhausted (or another exception is raised), or for eval_steps steps, if specified.</li>
</ul>
</li>
<li>train_monitors<ul>
<li>A list of monitors to pass to the Estimator’s fit function.</li>
</ul>
</li>
<li>eval_hooks<ul>
<li>A list of SessionRunHook hooks to pass to the Estimator’s evaluate function.</li>
</ul>
</li>
<li>eval_delay_secs<ul>
<li>Start evaluating after waiting for this many seconds.</li>
</ul>
</li>
<li>continuous_eval_throttle_secs<ul>
<li>when the last evaluation was started at least this many seconds ago for continuous_eval(), re-evaluate.</li>
</ul>
</li>
<li>min_eval_frequency<ul>
<li>(applies only to train_and_evaluate).</li>
<li>the minimum number of steps between evaluations.</li>
<li>Of course, evaluation does not occur if no new snapshot is available, hence, this is the minimum. If 0, the evaluation will only happen after training. If None, defaults to 1, unless model_dir is on GCS, in which case the default is 1000.</li>
</ul>
</li>
<li>delay_workers_by_global_step<ul>
<li>if True delays training workers based on global step instead of time.</li>
</ul>
</li>
<li>export_strategies<ul>
<li>Iterable of ExportStrategys, or a single one, or None.</li>
</ul>
</li>
<li>train_steps_per_iteration<ul>
<li>(applies only to continuous_train_and_eval).</li>
<li>Perform this many (integer) number of train steps for each training-evaluation iteration.</li>
<li>With a small value, the model will be evaluated more frequently with more checkpoints saved. </li>
<li>If None, will use a default value (which is smaller than train_steps if provided).</li>
</ul>
</li>
</ul>
<h3 id="supervisor"><a href="#supervisor" class="headerlink" title="supervisor"></a>supervisor</h3><h4 id="basic-use-process"><a href="#basic-use-process" class="headerlink" title="basic use process"></a>basic use process</h4><ol>
<li>Create a Supervisor object,<ul>
<li>parameter: logdir</li>
<li>the path to a directory where to save checkpoints and summaries.</li>
</ul>
</li>
<li>Ask the supervisor for a session with <code>tf.train.Supervisor.managed_session</code></li>
<li>Use the session to execute a train op, checking at each step if the supervisor requests that the training stops.</li>
</ol>
<h5 id="started-services"><a href="#started-services" class="headerlink" title="started services"></a>started services</h5><p>The managed_session() call starts a few services, which run in their own threads and use the managed session to run ops in your graph.<br>If your graph contains an integer variable named global_step, the services use its value to measure the number of training steps executed.</p>
<ul>
<li>Checkpointing service: Saves a copy of the graph variables in the logdir. <ul>
<li>The checkpoint filename uses the value of the global_step variable if one was added to your graph.</li>
<li>Runs every 10 minutes by default.</li>
</ul>
</li>
<li>Summary service: Runs all the summary ops and appends their output to an events file in the logdir.<ul>
<li>Runs every 2 minutes by default.</li>
</ul>
</li>
<li>Step counter: Counts how many steps have been executed, by looking at changes in the global_step variable.<ul>
<li>Appends a summary to the events file reporting the number of global steps per second.</li>
<li>The summary tag is “global_step/sec”. </li>
<li>This also runs every 2 minutes by default.</li>
</ul>
</li>
<li><em>Queue Runners</em>: If any <code>tf.train.QueueRunner</code> were added to the graph, the supervisor launches them in their own threads.</li>
</ul>
<h5 id="Checking-for-Stop"><a href="#Checking-for-Stop" class="headerlink" title="Checking for Stop"></a>Checking for Stop</h5><p>The check for stop in the main training loop is important and necessary.</p>
<ol>
<li>Exceptions raised in the service threads are reported to the supervisor which then sets its should_stop() condition to true.</li>
<li>Other service threads notice that condition and terminate properly. </li>
<li>The main training loop, within the managed_session() block, must also check for the stop condition and terminate.</li>
</ol>
<p><strong><em>Notice</em></strong>:<br><code>managed_session()</code> takes care of catching exceptions raised from the training loop to report them to the supervisor.<br>The main loop does not need to do anything special about exceptions. It only needs to check for the stop condition.</p>
<h5 id="Recovery"><a href="#Recovery" class="headerlink" title="Recovery"></a>Recovery</h5><p>If the training program shuts down or crashes, its most recent checkpoint and event files are left in the logdir.<br>When you restart the program, managed_session() restores the graph from the most recent checkpoint and resumes training where it stopped.<br>A new events file is created. If you start TensorBoard and point it to the logdir, it will know how to <strong>merge</strong> the contents of the two events files and will show the training resuming at the last global step from the checkpoint.</p>
<h4 id="Larger-Model-Scenario"><a href="#Larger-Model-Scenario" class="headerlink" title="Larger Model Scenario"></a>Larger Model Scenario</h4><p>Larger models may run out memory when the summary service runs:</p>
<ul>
<li>The summary ops are run in parallel with the main loop running the train op.</li>
<li>This can cause memory usage to peak to up to two times the normal use.</li>
</ul>
<p>For a larger model you can tell the supervisor to <strong>not run</strong> the summary service and instead run it yourself in your main training loop:</p>
<ul>
<li>pass <code>summary_op=None</code> when constructing the supervisor.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">...create graph...</div><div class="line">my_train_op = ...</div><div class="line">my_summary_op = tf.summary.merge_all()</div><div class="line"></div><div class="line">sv = tf.train.Supervisor(logdir=<span class="string">"/my/training/directory"</span>,</div><div class="line">                   summary_op=<span class="keyword">None</span>) <span class="comment"># Do not run the summary service</span></div><div class="line"><span class="keyword">with</span> sv.managed_session() <span class="keyword">as</span> sess:</div><div class="line">  <span class="keyword">for</span> step <span class="keyword">in</span> range(<span class="number">100000</span>):</div><div class="line">    <span class="keyword">if</span> sv.should_stop():</div><div class="line">      <span class="keyword">break</span></div><div class="line">    <span class="keyword">if</span> step % <span class="number">100</span> == <span class="number">0</span>:</div><div class="line">      _, summ = sess.run([my_train_op, my_summary_op])</div><div class="line">      sv.summary_computed(sess, summ)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">      sess.run(my_train_op)</div></pre></td></tr></table></figure>
<h4 id="Pre-trained-Model-Scenario"><a href="#Pre-trained-Model-Scenario" class="headerlink" title="Pre-trained Model Scenario"></a>Pre-trained Model Scenario</h4><p>The managed_session() call takes care of initializing the model in the session</p>
<ul>
<li>If model is available, it is restored from a checkpoint.</li>
<li>otherwise, initialized from scratch.</li>
</ul>
<p>One common scenario is to initialize the model by loading a “pre-trained” checkpoint that was saved while training a usually slightly different model using a different dataset.</p>
<h5 id="init-function"><a href="#init-function" class="headerlink" title="init function"></a>init function</h5><ul>
<li>is called only if the model needs to be initialized from scratch</li>
<li>not when the model can be recovered from a checkpoint from the logdir.</li>
</ul>
<p>To load the pre-trained model, the init function needs a <code>tf.train.Saver</code> object</p>
<ul>
<li>This saver must only restore the pre-trained variables</li>
<li>This is usually a good idea because the new model may contain variables that are not present in the pre-trained checkpoint</li>
<li>If you were using the default saver, you could get an error trying to restore all the variables of the new model from the pre-trained checkpoint.</li>
</ul>
<p>The process is below:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">...create graph...</div><div class="line"><span class="comment"># Create a saver that restores only the pre-trained variables.</span></div><div class="line">pre_train_saver = tf.train.Saver([pre_train_var1, pre_train_var2])</div><div class="line"></div><div class="line"><span class="comment"># Define an init function that loads the pretrained checkpoint.</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_pretrain</span><span class="params">(sess)</span>:</span></div><div class="line">  pre_train_saver.restore(sess, <span class="string">"&lt;path to pre-trained-checkpoint&gt;"</span>)</div><div class="line"></div><div class="line"><span class="comment"># Pass the init function to the supervisor.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The init function is called _after_ the variables have been initialized</span></div><div class="line"><span class="comment"># by running the init_op.</span></div><div class="line">sv = tf.train.Supervisor(logdir=<span class="string">"/my/training/directory"</span>,</div><div class="line">                   init_fn=load_pretrain)</div><div class="line"><span class="keyword">with</span> sv.managed_session() <span class="keyword">as</span> sess:</div><div class="line">  <span class="comment"># Here sess was either initialized from the pre-trained-checkpoint or</span></div><div class="line">  <span class="comment"># recovered from a checkpoint saved in a previous run of this code.</span></div><div class="line">  ...</div></pre></td></tr></table></figure></p>
<h4 id="Running-Your-Own-Services"><a href="#Running-Your-Own-Services" class="headerlink" title="Running Your Own Services"></a>Running Your Own Services</h4><p>For example to fetch different sets of summaries on a different schedule than the usual summary service.<br>Use the <code>tf.train.Supervisor.loop</code>method</p>
<ul>
<li>It repeatedly calls a function of your choice on a timer until the supervisor stop condition becomes true</li>
<li>It plays nicely with the other services.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_additional_summaries</span><span class="params">(sv, sess)</span>:</span></div><div class="line"> ...fetch <span class="keyword">and</span> write summaries, see below...</div><div class="line"></div><div class="line">...</div><div class="line">  sv = tf.train.Supervisor(logdir=<span class="string">"/my/training/directory"</span>)</div><div class="line">  <span class="keyword">with</span> sv.managed_session() <span class="keyword">as</span> sess:</div><div class="line">    <span class="comment"># Call my_additional_summaries() every 1200s, or 20mn,</span></div><div class="line">    <span class="comment"># passing (sv, sess) as arguments.</span></div><div class="line">    sv.loop(<span class="number">1200</span>, my_additional_summaries, args=(sv, sess))</div><div class="line">    ...main training loop...</div></pre></td></tr></table></figure>
<h4 id="Writing-Summaries"><a href="#Writing-Summaries" class="headerlink" title="Writing Summaries"></a>Writing Summaries</h4><p>The supervisor always creates an events file in its logdir, as well as a <code>tf.summary.FileWriter</code> to append events and summaries to that file.<br>If you want to write your own summaries it is a good idea to append them to that same events file</p>
<ul>
<li>TensorBoard likes it better when only one events file in a directory is being actively appended to.</li>
</ul>
<p>Method: <code>tf.train.Supervisor.summary_computed</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_additional_summaries</span><span class="params">(sv, sess)</span>:</span></div><div class="line">  summaries = sess.run(my_additional_summary_op)</div><div class="line">  sv.summary_computed(sess, summaries)</div></pre></td></tr></table></figure></p>
<p>For more advanced usages:<br><code>tf.train.Supervisor.summary_writer</code><br><a href="https://www.tensorflow.org/api_docs/python/tf/train/Supervisor#summary_writer" target="_blank" rel="external">https://www.tensorflow.org/api_docs/python/tf/train/Supervisor#summary_writer</a></p>
<h4 id="Supervisor-Reference"><a href="#Supervisor-Reference" class="headerlink" title="Supervisor Reference"></a>Supervisor Reference</h4><h5 id="Checkpointing-Where-and-When"><a href="#Checkpointing-Where-and-When" class="headerlink" title="Checkpointing: Where and When."></a>Checkpointing: Where and When.</h5><p>checkpointing service can be configured by the following keyword arguments to the Supervisor() constructor:</p>
<ul>
<li>logdir:<ul>
<li>path where the checkpointing service creates <strong>checkpoints</strong>.</li>
<li>Passing None disables the checkpointing and the summary services.</li>
</ul>
</li>
<li>checkpoint_basename<ul>
<li>Name of the checkpoint files to create, defaults to “model.ckpt”.</li>
<li>If the model contains a scalar integer variable named global_step, the value of that variable is appended to the checkpoint filename.</li>
</ul>
</li>
<li>save_model_secs<ul>
<li>Number of seconds between each checkpoint. Defaults to 600, or 10 minutes.</li>
</ul>
</li>
<li>saver<ul>
<li>A <code>tf.train.Saver</code> object to use for checkpointing.</li>
<li>Default creates one for you by calling tf.train.Saver(), which add ops to save and restore all variables in your model.</li>
<li>customer Saver need create customized Saver.</li>
</ul>
</li>
</ul>
<h5 id="Summaries-Where-and-When"><a href="#Summaries-Where-and-When" class="headerlink" title="Summaries: Where and When"></a>Summaries: Where and When</h5><p>the summary service can be configured by the following keyword arguments to the Supervisor() constructor:</p>
<ul>
<li>logdir<ul>
<li>Path to a directory where the summary service creates <strong>event</strong> files.</li>
<li>Passing None disables the summary service as well as the checkpointing services.</li>
</ul>
</li>
<li>save_summaries_secs<ul>
<li>Number of seconds between each run of the summary service</li>
<li>Defaults to 120, or 2 minutes.</li>
<li>Pass 0 to disable the summary service.</li>
</ul>
</li>
<li>summary_op<ul>
<li>Op to use to fetch the summaries.</li>
<li>Default use the first op in the <code>tf.GraphKeys.SUMMARY_OP</code> graph collection.</li>
<li>If the collection is empty the supervisor creates an op that aggregates all summaries in the graph using <code>tf.summary.merge_all()</code></li>
<li>Passing None disables the summary service.</li>
</ul>
</li>
<li>global_step<ul>
<li>Tensor to use to count the global step.</li>
<li>Default uses the first tensor in the tf.GraphKeys.GLOBAL_STEP graph collection.</li>
<li>If the collection is empty, the supervisor looks for a scalar integer variable named <code>global_step</code> in the graph.</li>
<li>If found, the global step tensor is used to measure the number of training steps executed</li>
<li>Note that your training op is responsible for incrementing the global step value.</li>
</ul>
</li>
</ul>
<h5 id="Model-Initialization-and-Recovery"><a href="#Model-Initialization-and-Recovery" class="headerlink" title="Model Initialization and Recovery"></a>Model Initialization and Recovery</h5><h6 id="initialization"><a href="#initialization" class="headerlink" title="initialization"></a>initialization</h6><p>The <code>managed_session()</code> call takes care of initializing or recovering a session.<br>It returns a session with a fully initialized model, ready to run ops.<br>If a checkpoint <strong>exists</strong> in the logdir when <code>managed_session()</code> is called, the model is initialized by loading that <strong>checkpoint</strong><br><strong>otherwise</strong> it is initialized by calling an init op and optionally an init function.<br>When no checkpoint is available, model initialization is controlled by the following keyword arguments to the <code>Supervisor()</code> constructor:</p>
<ul>
<li>init_op<ul>
<li>Op to run to initialize the model.</li>
<li>Default uses the first op in the <code>tf.GraphKeys.INIT_OP</code> collection.</li>
<li>If the collection is empty, the supervisor adds an op to initialize all the variables in the graph by calling <code>tf.global_variables_initializer()</code>.</li>
<li>Pass None to not use an init op.</li>
</ul>
</li>
<li>init_fn<ul>
<li>Python function to call to initialize the model.</li>
<li>If specified, called as init_fn(sess) where sess is the managed session. </li>
<li>If an init op is also used, the init function is called after the init op.</li>
</ul>
</li>
<li>local_init_op<ul>
<li>An additional op to initialize parts of the graph that are not saved in checkpoints such as tables and local variables.</li>
<li>The local init op is run before the init op and the init function.</li>
<li>If not specified, the supervisor uses the first op in the <code>tf.GraphKeys.LOCAL_INIT_OP</code> collection.</li>
<li>If the collection is empty the supervisor adds an op to initialize all the tables and local variables in the graph by calling <code>tf.tables_initializer()</code> and <code>tf.local_variables_initializer()</code>.</li>
<li>Pass None to not use a local init op.</li>
</ul>
</li>
<li>ready_op<ul>
<li>Op to check if the model is initialized.</li>
<li>After running the local init op, the init op, and the init function, the supervisor verifies that the model is fully initialized by running the ready op. </li>
<li>This is an op that returns an empty string if the model is initialized, or a description of what parts of the model are not initialized if not.</li>
<li>This is an op that returns an empty string if the model is initialized, or a description of what parts of the model are not initialized if not.</li>
<li>If not specified, the supervisor uses the first op in the tf.GraphKeys.READY_OP collection.</li>
<li>f the collection is empty the supervisor creates a ready op that verifies that all variables are initialized by calling <code>tf.report_uninitialized_variables()</code>.</li>
<li>Pass None to disable the ready op. In that case the model is not checked after initialization.</li>
</ul>
</li>
</ul>
<h6 id="Recovery-1"><a href="#Recovery-1" class="headerlink" title="Recovery"></a>Recovery</h6><p>Checkpoint recovery is controlled by the following keyword arguments to the Supervisor() constructor:</p>
<ul>
<li>logdir<ul>
<li>Path to a directory in which to look for checkpoints.</li>
<li>The checkpoint service saves a metadata file, named “checkpoint”, in the checkpoint directory that indicates the path to the most recent checkpoint.</li>
<li>This file is in text format. When in a pinch, you can edit it manually to recover from a different checkpoint than the most recent one.</li>
</ul>
</li>
<li>ready_op: (see above).<ul>
<li>The ready op is run before and after loading the checkpoint. </li>
<li>The first run checks if the model needs to be initialized</li>
<li>the second run verifies that the model is fully initialized.</li>
</ul>
</li>
<li>local_init_op: (see above).<ul>
<li>The local init op is run before running the ready op the first time, to initialize local variables and tables.</li>
<li>saver: (see above). Saver object used to load the checkpoint.</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/23/tf_distributed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Klpek">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klpek's Note Library">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/23/tf_distributed/" itemprop="url">
                  Untitled
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-23T21:39:04+08:00">
                2017-08-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/23/tf_distributed/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/23/tf_distributed/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Easy-demo"><a href="#Easy-demo" class="headerlink" title="Easy demo"></a>Easy demo</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Start a TensorFlow server as a single-process "cluster".</span></div><div class="line">$ python</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>c = tf.constant(<span class="string">"Hello, distributed TensorFlow!"</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>server = tf.train.Server.create_local_server()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>sess = tf.Session(server.target)  <span class="comment"># Create a session on the server.</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>sess.run(c)</div><div class="line"><span class="string">'Hello, distributed TensorFlow!'</span></div></pre></td></tr></table></figure>
<p>The <code>tf.train.Server.create_local_server</code> method creates a single-process cluster, with an in-process server.</p>
<h3 id="Create-a-cluster"><a href="#Create-a-cluster" class="headerlink" title="Create a cluster"></a>Create a cluster</h3><h4 id="cluster"><a href="#cluster" class="headerlink" title="cluster"></a>cluster</h4><p>a set of “tasks” that participate in the distributed execution of a TensorFlow graph.</p>
<h6 id="task"><a href="#task" class="headerlink" title="task"></a>task</h6><p>Each task is associated with a TensorFlow “server”.</p>
<ul>
<li>which contains a “master” that can be used to create sessions, </li>
<li>and a “worker” that executes operations in the graph.</li>
</ul>
<h6 id="jobs"><a href="#jobs" class="headerlink" title="jobs"></a>jobs</h6><p>A cluster can also be divided into one or more “jobs”,</p>
<ul>
<li>where each job contains one or more tasks.</li>
</ul>
<h4 id="create-cluster"><a href="#create-cluster" class="headerlink" title="create cluster"></a>create cluster</h4><p>start one TensorFlow server per task in the cluster.<br>Each task typically runs on a different machine<br>but you can run multiple tasks on the same machine<br>In each task, do the following:</p>
<ol>
<li><strong>Create a</strong> <code>tf.train.ClusterSpec</code> that describes all of the tasks in the cluster. <ul>
<li>This should be the same for each task.</li>
</ul>
</li>
<li>Create a tf.train.Server<ul>
<li>passing the <code>tf.train.ClusterSpec</code> to the constructor,</li>
<li>identifying the local task with a job name and task index.</li>
</ul>
</li>
</ol>
<h5 id="Create-a-tf-train-ClusterSpec-to-describe-the-cluster"><a href="#Create-a-tf-train-ClusterSpec-to-describe-the-cluster" class="headerlink" title="Create a tf.train.ClusterSpec to describe the cluster"></a>Create a <code>tf.train.ClusterSpec</code> to describe the cluster</h5><p>The cluster specification dictionary maps job names to lists of network addresses.<br>Pass this dictionary to the tf.train.ClusterSpec constructor.</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tf.train.ClusterSpec(&#123;<span class="string">"local"</span>: [<span class="string">"localhost:2222"</span>, <span class="string">"localhost:2223"</span>]&#125;)</div></pre></td></tr></table></figure>
<p>/job:local/task:0<br>/job:local/task:1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">tf.train.ClusterSpec(&#123;</div><div class="line">    <span class="string">"worker"</span>: [</div><div class="line">        <span class="string">"worker0.example.com:2222"</span>,</div><div class="line">        <span class="string">"worker1.example.com:2222"</span>,</div><div class="line">        <span class="string">"worker2.example.com:2222"</span></div><div class="line">    ],</div><div class="line">    <span class="string">"ps"</span>: [</div><div class="line">        <span class="string">"ps0.example.com:2222"</span>,</div><div class="line">        <span class="string">"ps1.example.com:2222"</span></div><div class="line">    ]&#125;)</div></pre></td></tr></table></figure>
<p>/job:worker/task:0<br>/job:worker/task:1<br>/job:worker/task:2<br>/job:ps/task:0<br>/job:ps/task:1</p>
</blockquote>
<h5 id="Create-a-tf-train-Server-instance-in-each-task"><a href="#Create-a-tf-train-Server-instance-in-each-task" class="headerlink" title="Create a tf.train.Server instance in each task"></a>Create a tf.train.Server instance in each task</h5><p>A <code>tf.train.Server</code> object contains</p>
<ul>
<li>a set of local devices, a set of connections to other tasks in its <code>tf.train.ClusterSpec</code>.</li>
<li>a tf.Session that can use these to perform a distributed computation.</li>
</ul>
<p>Each server is a member of a specific named job and has a task index within that job.<br>A server can communicate with any other server in the cluster.</p>
<p>For example, to launch a cluster with two servers running on localhost:2222 and localhost:2223, run the following snippets in two different processes on the local machine:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># In task 0:</span></div><div class="line">cluster = tf.train.ClusterSpec(&#123;<span class="string">"local"</span>: [<span class="string">"localhost:2222"</span>, <span class="string">"localhost:2223"</span>]&#125;)</div><div class="line">server = tf.train.Server(cluster, job_name=<span class="string">"local"</span>, task_index=<span class="number">0</span>)</div><div class="line"></div><div class="line"><span class="comment"># In task 1:</span></div><div class="line">cluster = tf.train.ClusterSpec(&#123;<span class="string">"local"</span>: [<span class="string">"localhost:2222"</span>, <span class="string">"localhost:2223"</span>]&#125;)</div><div class="line">server = tf.train.Server(cluster, job_name=<span class="string">"local"</span>, task_index=<span class="number">1</span>)</div></pre></td></tr></table></figure></p>
<h4 id="Specifying-distributed-devices-in-your-model"><a href="#Specifying-distributed-devices-in-your-model" class="headerlink" title="Specifying distributed devices in your model"></a>Specifying distributed devices in your model</h4><p>To place operations on a particular process, you can use the same tf.device function that is used to specify whether ops run on the CPU or GPU. For example:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> tf.device(<span class="string">"/job:ps/task:0"</span>):</div><div class="line">  weights_1 = tf.Variable(...)</div><div class="line">  biases_1 = tf.Variable(...)</div><div class="line"></div><div class="line"><span class="keyword">with</span> tf.device(<span class="string">"/job:ps/task:1"</span>):</div><div class="line">  weights_2 = tf.Variable(...)</div><div class="line">  biases_2 = tf.Variable(...)</div><div class="line"></div><div class="line"><span class="keyword">with</span> tf.device(<span class="string">"/job:worker/task:7"</span>):</div><div class="line">  input, labels = ...</div><div class="line">  layer_1 = tf.nn.relu(tf.matmul(input, weights_1) + biases_1)</div><div class="line">  logits = tf.nn.relu(tf.matmul(layer_1, weights_2) + biases_2)</div><div class="line">  <span class="comment"># ...</span></div><div class="line">  train_op = ...</div><div class="line"></div><div class="line"><span class="keyword">with</span> tf.Session(<span class="string">"grpc://worker7.example.com:2222"</span>) <span class="keyword">as</span> sess:</div><div class="line">  <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10000</span>):</div><div class="line">    sess.run(train_op)</div></pre></td></tr></table></figure></p>
<p>In the above example, the variables are created on two tasks in the ps job, and the compute-intensive part of the model is created in the worker job. TensorFlow will insert the appropriate data transfers between the jobs (from ps to worker for the forward pass, and from worker to ps for applying gradients).</p>
<h4 id="Replicated-training"><a href="#Replicated-training" class="headerlink" title="Replicated training"></a>Replicated training</h4><p>A common training configuration, called “data parallelism,” </p>
<ul>
<li>involves <strong>multiple tasks</strong> in a <strong>worker job</strong> training the <strong>same model</strong> on <strong>different mini-batches</strong> of data, </li>
<li>updating shared parameters hosted in one or more tasks in a ps job.</li>
</ul>
<p>There are many ways to specify this structure in TensorFlow, and we are building libraries that will simplify the work of specifying a replicated model.<br>Possible approaches include:</p>
<ul>
<li>In-graph replication.<ul>
<li>In this approach, the client builds a single tf.Graph that contains one set of parameters (in tf.Variable nodes pinned to /job:ps); </li>
<li>and multiple copies of the compute-intensive part of the model, each pinned to a different task in /job:worker.</li>
</ul>
</li>
<li>Between-graph replication.?<ul>
<li>In this approach, there is a separate client for each /job:worker task, typically in the same process as the worker task.</li>
<li>Each client builds a similar graph containing the parameters <ul>
<li>(pinned to /job:ps as before using <code>tf.train.replica_device_setter</code> to map them deterministically to the same tasks)</li>
</ul>
</li>
<li>and a single copy of the compute-intensive part of the model, pinned to the local task in /job:worker.</li>
</ul>
</li>
<li>Asynchronous training.?<ul>
<li>In this approach, each replica of the graph has an independent training loop that executes without coordination. It is compatible with both forms of replication above.</li>
</ul>
</li>
<li>Synchronous training. <ul>
<li>n this approach, all of the replicas read the same values for the current parameters, compute gradients in parallel, and then apply them together.</li>
<li>It is compatible with in-graph replication (e.g. using gradient averaging as in the CIFAR-10 multi-GPU trainer), and between-graph replication (e.g. using the tf.train.SyncReplicasOptimizer).</li>
</ul>
</li>
</ul>
<h5 id="Putting-it-all-together-example-trainer-program"><a href="#Putting-it-all-together-example-trainer-program" class="headerlink" title="Putting it all together: example trainer program"></a>Putting it all together: example trainer program</h5><p>The following code shows the skeleton of a distributed trainer program<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> argparse</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line"></div><div class="line">FLAGS = <span class="keyword">None</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(_)</span>:</span></div><div class="line">  ps_hosts = FLAGS.ps_hosts.split(<span class="string">","</span>)</div><div class="line">  worker_hosts = FLAGS.worker_hosts.split(<span class="string">","</span>)</div><div class="line"></div><div class="line">  <span class="comment"># Create a cluster from the parameter server and worker hosts.</span></div><div class="line">  cluster = tf.train.ClusterSpec(&#123;<span class="string">"ps"</span>: ps_hosts, <span class="string">"worker"</span>: worker_hosts&#125;)</div><div class="line"></div><div class="line">  <span class="comment"># Create and start a server for the local task.</span></div><div class="line">  server = tf.train.Server(cluster,</div><div class="line">                           job_name=FLAGS.job_name,</div><div class="line">                           task_index=FLAGS.task_index)</div><div class="line"></div><div class="line">  <span class="keyword">if</span> FLAGS.job_name == <span class="string">"ps"</span>:</div><div class="line">    server.join()</div><div class="line">  <span class="keyword">elif</span> FLAGS.job_name == <span class="string">"worker"</span>:</div><div class="line"></div><div class="line">    <span class="comment"># Assigns ops to the local worker by default.</span></div><div class="line">    <span class="keyword">with</span> tf.device(tf.train.replica_device_setter(</div><div class="line">        worker_device=<span class="string">"/job:worker/task:%d"</span> % FLAGS.task_index,</div><div class="line">        cluster=cluster)):</div><div class="line"></div><div class="line">      <span class="comment"># Build model...</span></div><div class="line">      loss = ...</div><div class="line">      global_step = tf.contrib.framework.get_or_create_global_step()</div><div class="line"></div><div class="line">      train_op = tf.train.AdagradOptimizer(<span class="number">0.01</span>).minimize(</div><div class="line">          loss, global_step=global_step)</div><div class="line"></div><div class="line">    <span class="comment"># The StopAtStepHook handles stopping after running given steps.</span></div><div class="line">    hooks=[tf.train.StopAtStepHook(last_step=<span class="number">1000000</span>)]</div><div class="line"></div><div class="line">    <span class="comment"># The MonitoredTrainingSession takes care of session initialization,</span></div><div class="line">    <span class="comment"># restoring from a checkpoint, saving to a checkpoint, and closing when done</span></div><div class="line">    <span class="comment"># or an error occurs.</span></div><div class="line">    <span class="keyword">with</span> tf.train.MonitoredTrainingSession(master=server.target,</div><div class="line">                                           is_chief=(FLAGS.task_index == <span class="number">0</span>),</div><div class="line">                                           checkpoint_dir=<span class="string">"/tmp/train_logs"</span>,</div><div class="line">                                           hooks=hooks) <span class="keyword">as</span> mon_sess:</div><div class="line">      <span class="keyword">while</span> <span class="keyword">not</span> mon_sess.should_stop():</div><div class="line">        <span class="comment"># Run a training step asynchronously.</span></div><div class="line">        <span class="comment"># See `tf.train.SyncReplicasOptimizer` for additional details on how to</span></div><div class="line">        <span class="comment"># perform *synchronous* training.</span></div><div class="line">        <span class="comment"># mon_sess.run handles AbortedError in case of preempted PS.</span></div><div class="line">        mon_sess.run(train_op)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">  parser = argparse.ArgumentParser()</div><div class="line">  parser.register(<span class="string">"type"</span>, <span class="string">"bool"</span>, <span class="keyword">lambda</span> v: v.lower() == <span class="string">"true"</span>)</div><div class="line">  <span class="comment"># Flags for defining the tf.train.ClusterSpec</span></div><div class="line">  parser.add_argument(</div><div class="line">      <span class="string">"--ps_hosts"</span>,</div><div class="line">      type=str,</div><div class="line">      default=<span class="string">""</span>,</div><div class="line">      help=<span class="string">"Comma-separated list of hostname:port pairs"</span></div><div class="line">  )</div><div class="line">  parser.add_argument(</div><div class="line">      <span class="string">"--worker_hosts"</span>,</div><div class="line">      type=str,</div><div class="line">      default=<span class="string">""</span>,</div><div class="line">      help=<span class="string">"Comma-separated list of hostname:port pairs"</span></div><div class="line">  )</div><div class="line">  parser.add_argument(</div><div class="line">      <span class="string">"--job_name"</span>,</div><div class="line">      type=str,</div><div class="line">      default=<span class="string">""</span>,</div><div class="line">      help=<span class="string">"One of 'ps', 'worker'"</span></div><div class="line">  )</div><div class="line">  <span class="comment"># Flags for defining the tf.train.Server</span></div><div class="line">  parser.add_argument(</div><div class="line">      <span class="string">"--task_index"</span>,</div><div class="line">      type=int,</div><div class="line">      default=<span class="number">0</span>,</div><div class="line">      help=<span class="string">"Index of task within the job"</span></div><div class="line">  )</div><div class="line">  FLAGS, unparsed = parser.parse_known_args()</div><div class="line">  tf.app.run(main=main, argv=[sys.argv[<span class="number">0</span>]] + unparsed)</div></pre></td></tr></table></figure></p>
<h4 id="Glossary"><a href="#Glossary" class="headerlink" title="Glossary"></a>Glossary</h4><h5 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h5><p>A client is typically a program that builds a TensorFlow graph and constructs a tensorflow::Session to interact with a cluster.<br>A single client process can directly interact with multiple TensorFlow servers (see “Replicated training” above), and a single server can serve multiple clients.</p>
<h5 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h5><p>A TensorFlow cluster comprises a one or more “jobs”, each divided into lists of one or more “tasks”.<br>A cluster is typically dedicated to a particular high-level objective, such as training a neural network, using many machines in parallel.<br>A cluster is defined by a tf.train.ClusterSpec object.</p>
<h5 id="Job"><a href="#Job" class="headerlink" title="Job"></a>Job</h5><p>A job comprises a list of “tasks”, which typically serve a common purpose.<br>For example, a job named ps (for “parameter server”) typically hosts nodes that store and update variables<br>while a job named worker typically hosts stateless nodes that perform compute-intensive tasks.<br>The tasks in a job typically run on different machines.<br>The set of job roles is flexible: for example, a worker may maintain some state.</p>
<h5 id="Master-service"><a href="#Master-service" class="headerlink" title="Master service"></a>Master service</h5><p>An RPC service that provides remote access to a set of distributed devices, and acts as a session target.<br>The master service implements the tensorflow::Session interface, and is responsible for coordinating work across one or more “worker services”.<br>All TensorFlow servers implement the master service.</p>
<h5 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h5><p>A task corresponds to a specific TensorFlow server, and typically corresponds to a single process. A task belongs to a particular “job” and is identified by its index within that job’s list of tasks.</p>
<h5 id="TensorFlow-server"><a href="#TensorFlow-server" class="headerlink" title="TensorFlow server"></a>TensorFlow server</h5><p>A process running a tf.train.Server instance, which is a member of a cluster, and exports a “master service” and “worker service”.</p>
<h5 id="Worker-service"><a href="#Worker-service" class="headerlink" title="Worker service"></a>Worker service</h5><p>An RPC service that executes parts of a TensorFlow graph using its local devices. A worker service implements worker_service.proto. All TensorFlow servers implement the worker service.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/19/tf_supervisor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Klpek">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klpek's Note Library">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/19/tf_supervisor/" itemprop="url">
                  Untitled
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-19T20:13:40+08:00">
                2017-08-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/19/tf_supervisor/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/19/tf_supervisor/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>supervisor<br><a href="https://www.tensorflow.org/programmers_guide/supervisor" target="_blank" rel="external">https://www.tensorflow.org/programmers_guide/supervisor</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/19/tf_experiment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Klpek">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klpek's Note Library">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/19/tf_experiment/" itemprop="url">
                  Untitled
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-19T20:11:04+08:00">
                2017-08-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/19/tf_experiment/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/19/tf_experiment/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/19/tf_estimator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Klpek">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klpek's Note Library">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/19/tf_estimator/" itemprop="url">
                  Untitled
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-19T20:06:48+08:00">
                2017-08-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/19/tf_estimator/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/19/tf_estimator/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="tf-estimator-学习"><a href="#tf-estimator-学习" class="headerlink" title="tf.estimator 学习"></a>tf.estimator 学习</h2><h3 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h3><p>两个基本参数: model_fn and params<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nn = tf.estimator.Estimator(model_fn=model_fn, params=model_params)</div></pre></td></tr></table></figure></p>
<ul>
<li>model_fn: A function object that contains all the aforementioned logic to support training, evaluation, and prediction. You are responsible for implementing that functionality.</li>
<li>params: An optional dict of hyperparameters (e.g., learning rate, dropout) that will be passed into the model_fn.</li>
</ul>
<p><strong><em>Notice</em></strong>:<br>The <code>Estimator</code> also accepts the general configuration arguments model_dir and config.</p>
<h4 id="构建model-fn"><a href="#构建model-fn" class="headerlink" title="构建model_fn"></a>构建model_fn</h4><h5 id="基本骨架"><a href="#基本骨架" class="headerlink" title="基本骨架"></a>基本骨架</h5><h6 id="Input-接受参数"><a href="#Input-接受参数" class="headerlink" title="Input: 接受参数"></a>Input: 接受参数</h6><ul>
<li>features<ul>
<li>A <strong>dict</strong> containing the <em>features</em> passed to the model via <code>input_fn</code>.</li>
</ul>
</li>
<li>labels<ul>
<li>A <strong>Tensor</strong> containing the <em>labels</em> passed to the model via <code>input_fn</code></li>
<li>Will be <strong>empty</strong> for predict() calls, as these are the values the model will infer.</li>
</ul>
</li>
<li>mode<ul>
<li><code>tf.estimator.ModeKeys.TRAIN</code> The model_fn was invoked in training mode, namely via a <code>train()</code> call</li>
<li><code>tf.estimator.ModeKeys.EVAL</code> The model_fn was invoked in evaluation mode, namely via an <code>evaluate()</code> call.</li>
<li><code>tf.estimator.ModeKeys.PREDICT</code>  The model_fn was invoked in predict mode, namely via a <code>predict()</code> call.</li>
</ul>
</li>
<li>params<ul>
<li>containing a dict of hyperparameters used for training</li>
</ul>
</li>
</ul>
<h6 id="body-逻辑过程"><a href="#body-逻辑过程" class="headerlink" title="body: 逻辑过程"></a>body: 逻辑过程</h6><ol>
<li>Configure the model<ul>
<li>a neural network</li>
</ul>
</li>
<li>Define the loss function<ul>
<li>to calculate how closely the model’s predictions match the target values</li>
</ul>
</li>
<li>Define the training operation<ul>
<li>to specify the <code>optimizer</code> algorithm to minimize the loss values calculated by the loss function.</li>
</ul>
</li>
<li>Generate predictions</li>
<li>Return predictions/loss/train_op/eval_metric_ops in EstimatorSpec object</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> EstimatorSpec(mode, predictions, loss, train_op, eval_metric_ops)</div></pre></td></tr></table></figure>
<h6 id="output-返回"><a href="#output-返回" class="headerlink" title="output: 返回"></a>output: 返回</h6><p>必须返回一个<code>tf.estimator.EstimatorSpec</code>对象<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> EstimatorSpec(mode, predictions, loss, train_op, eval_metric_ops)</div></pre></td></tr></table></figure></p>
<ul>
<li>mode (required in <strong>all</strong> mode)<ul>
<li>直接将model_fn的mode传递下去</li>
</ul>
</li>
<li>predictions (required in <strong>PREDICT</strong> mode)<ul>
<li>A dict that maps key names of your choice to Tensors containing the predictions from the model.</li>
<li>In PREDICT mode, the dict that you return in EstimatorSpec will then be returned by <code>predict()</code></li>
<li>you can construct it in the format in which you’d like to <strong>consume</strong> it</li>
</ul>
</li>
<li>loss ((required in <strong>EVAL</strong> and <strong>TRAIN</strong> mode))<ul>
<li>A Tensor containing a <em>scalar</em> loss value</li>
<li>the output of the model’s loss function</li>
<li>calculated over all the input examples</li>
<li>is used in TRAIN mode for <strong>error handling and logging</strong></li>
<li>is automatically included as a <strong>metric</strong> in EVAL mode.</li>
</ul>
</li>
<li>train_op (required only in <strong>TRAIN</strong> mode).<ul>
<li>An Op that runs one step of training</li>
</ul>
</li>
<li>eval_metric_ops (<em>optional</em>)<ul>
<li>A dict of name/value pairs specifying the metrics that will be calculated when the model runs in EVAL mode.</li>
<li>The name is a label of your choice for the metric</li>
<li>the value is the result of your metric calculation. </li>
<li>The <a href="https://www.tensorflow.org/api_docs/python/tf/metrics" target="_blank" rel="external">tf.metrics</a> module provides predefined functions for a variety of common metrics. <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">eval_metric_ops = &#123; <span class="string">"accuracy"</span>: tf.metrics.accuracy(labels, predictions) &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="相关API"><a href="#相关API" class="headerlink" title="相关API"></a>相关API</h5><p><a href="https://www.tensorflow.org/api_guides/python/train#optimizers" target="_blank" rel="external">optimizers</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/19/Untitled/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Klpek">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klpek's Note Library">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/19/Untitled/" itemprop="url">
                  Untitled
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-19T20:06:25+08:00">
                2017-08-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/19/Untitled/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/19/Untitled/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="tf-estimator-学习"><a href="#tf-estimator-学习" class="headerlink" title="tf.estimator 学习"></a>tf.estimator 学习</h2><h3 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h3><p>两个基本参数: model_fn and params<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nn = tf.estimator.Estimator(model_fn=model_fn, params=model_params)</div></pre></td></tr></table></figure></p>
<ul>
<li>model_fn: A function object that contains all the aforementioned logic to support training, evaluation, and prediction. You are responsible for implementing that functionality.</li>
<li>params: An optional dict of hyperparameters (e.g., learning rate, dropout) that will be passed into the model_fn.</li>
</ul>
<p><strong><em>Notice</em></strong>:<br>The <code>Estimator</code> also accepts the general configuration arguments model_dir and config.</p>
<h4 id="构建model-fn"><a href="#构建model-fn" class="headerlink" title="构建model_fn"></a>构建model_fn</h4><h5 id="基本骨架"><a href="#基本骨架" class="headerlink" title="基本骨架"></a>基本骨架</h5><h6 id="Input-接受参数"><a href="#Input-接受参数" class="headerlink" title="Input: 接受参数"></a>Input: 接受参数</h6><ul>
<li>features<ul>
<li>A <strong>dict</strong> containing the <em>features</em> passed to the model via <code>input_fn</code>.</li>
</ul>
</li>
<li>labels<ul>
<li>A <strong>Tensor</strong> containing the <em>labels</em> passed to the model via <code>input_fn</code></li>
<li>Will be <strong>empty</strong> for predict() calls, as these are the values the model will infer.</li>
</ul>
</li>
<li>mode<ul>
<li><code>tf.estimator.ModeKeys.TRAIN</code> The model_fn was invoked in training mode, namely via a <code>train()</code> call</li>
<li><code>tf.estimator.ModeKeys.EVAL</code> The model_fn was invoked in evaluation mode, namely via an <code>evaluate()</code> call.</li>
<li><code>tf.estimator.ModeKeys.PREDICT</code>  The model_fn was invoked in predict mode, namely via a <code>predict()</code> call.</li>
</ul>
</li>
<li>params<ul>
<li>containing a dict of hyperparameters used for training</li>
</ul>
</li>
</ul>
<h6 id="body-逻辑过程"><a href="#body-逻辑过程" class="headerlink" title="body: 逻辑过程"></a>body: 逻辑过程</h6><ol>
<li>Configure the model<ul>
<li>a neural network</li>
</ul>
</li>
<li>Define the loss function<ul>
<li>to calculate how closely the model’s predictions match the target values</li>
</ul>
</li>
<li>Define the training operation<ul>
<li>to specify the <code>optimizer</code> algorithm to minimize the loss values calculated by the loss function.</li>
</ul>
</li>
<li>Generate predictions</li>
<li>Return predictions/loss/train_op/eval_metric_ops in EstimatorSpec object</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> EstimatorSpec(mode, predictions, loss, train_op, eval_metric_ops)</div></pre></td></tr></table></figure>
<h6 id="output-返回"><a href="#output-返回" class="headerlink" title="output: 返回"></a>output: 返回</h6><p>必须返回一个<code>tf.estimator.EstimatorSpec</code>对象<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> EstimatorSpec(mode, predictions, loss, train_op, eval_metric_ops)</div></pre></td></tr></table></figure></p>
<ul>
<li>mode (required in <strong>all</strong> mode)<ul>
<li>直接将model_fn的mode传递下去</li>
</ul>
</li>
<li>predictions (required in <strong>PREDICT</strong> mode)<ul>
<li>A dict that maps key names of your choice to Tensors containing the predictions from the model.</li>
<li>In PREDICT mode, the dict that you return in EstimatorSpec will then be returned by <code>predict()</code></li>
<li>you can construct it in the format in which you’d like to <strong>consume</strong> it</li>
</ul>
</li>
<li>loss ((required in <strong>EVAL</strong> and <strong>TRAIN</strong> mode))<ul>
<li>A Tensor containing a <em>scalar</em> loss value</li>
<li>the output of the model’s loss function</li>
<li>calculated over all the input examples</li>
<li>is used in TRAIN mode for <strong>error handling and logging</strong></li>
<li>is automatically included as a <strong>metric</strong> in EVAL mode.</li>
</ul>
</li>
<li>train_op (required only in <strong>TRAIN</strong> mode).<ul>
<li>An Op that runs one step of training</li>
</ul>
</li>
<li>eval_metric_ops (<em>optional</em>)<ul>
<li>A dict of name/value pairs specifying the metrics that will be calculated when the model runs in EVAL mode.</li>
<li>The name is a label of your choice for the metric</li>
<li>the value is the result of your metric calculation. </li>
<li>The <a href="https://www.tensorflow.org/api_docs/python/tf/metrics" target="_blank" rel="external">tf.metrics</a> module provides predefined functions for a variety of common metrics. <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">eval_metric_ops = &#123; <span class="string">"accuracy"</span>: tf.metrics.accuracy(labels, predictions) &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="相关API"><a href="#相关API" class="headerlink" title="相关API"></a>相关API</h5><p><a href="https://www.tensorflow.org/api_guides/python/train#optimizers" target="_blank" rel="external">optimizers</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/18/tf-variable/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Klpek">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klpek's Note Library">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/18/tf-variable/" itemprop="url">
                  tf.Variable and tf.Tensor
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-18T19:25:09+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/18/tf-variable/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/18/tf-variable/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="tf-Variable"><a href="#tf-Variable" class="headerlink" title="tf.Variable"></a>tf.Variable</h3><h4 id="Create-variable"><a href="#Create-variable" class="headerlink" title="Create variable"></a>Create variable</h4><p>tf.get_variable</p>
<ul>
<li>easy to define models which reuse layers</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">my_int_variable = tf.get_variable(<span class="string">"my_int_variable"</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=tf.int32, </div><div class="line">  initializer=tf.zeros_initializer)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">other_variable = tf.get_variable(<span class="string">"other_variable"</span>, dtype=tf.int32, </div><div class="line">  initializer=tf.constant([<span class="number">23</span>, <span class="number">42</span>]))</div></pre></td></tr></table></figure>
<h4 id="Variable-collections"><a href="#Variable-collections" class="headerlink" title="Variable collections"></a>Variable collections</h4><p><strong>collections</strong>: name lists of tensors or other objects, such as <code>tf.Variable</code> instances.</p>
<h5 id="Predefined-collections"><a href="#Predefined-collections" class="headerlink" title="Predefined collections"></a>Predefined collections</h5><p>By default every tf.Variable gets placed in the following two collections:</p>
<ul>
<li><code>tf.GraphKeys.GLOBAL_VARIABLES</code><ul>
<li>variables that can be shared across multiple devices</li>
</ul>
</li>
<li><code>tf.GraphKeys.TRAINABLE_VARIABLE</code><ul>
<li>variables for which TensorFlow will calculate gradients</li>
</ul>
</li>
</ul>
<p>If you don’t want a variable to be trainable, add it to the <code>tf.GraphKeys.LOCAL_VARIABLES</code> collection instead.<br>The method is:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">my_local = tf.get_variable(<span class="string">"my_local"</span>, shape=(), </div><div class="line">							collections=[tf.GraphKeys.LOCAL_VARIABLES])</div></pre></td></tr></table></figure></p>
<p>or<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my_non_trainable = tf.get_variable(<span class="string">"my_non_trainable"</span>, shape=(), trainable=<span class="keyword">False</span>)</div></pre></td></tr></table></figure></p>
<h5 id="Custom-collections"><a href="#Custom-collections" class="headerlink" title="Custom collections"></a>Custom collections</h5><p>There is no need to explicitly create a collection.<br>To <em>add</em> a variable (or any other object) to a collection:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tf.add_to_collection(<span class="string">"my_collection_name"</span>, my_local)</div></pre></td></tr></table></figure></p>
<p>To retrieve a list of all the variables (or other objects) you’ve placed in a collection:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tf.get_collection(<span class="string">"my_collection_name"</span>)</div></pre></td></tr></table></figure></p>
<h4 id="Variable-placement"><a href="#Variable-placement" class="headerlink" title="Variable placement"></a>Variable placement</h4><p>Placement method:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> tf.device(<span class="string">"/gpu:1"</span>):</div><div class="line">  v = tf.get_variable(<span class="string">"v"</span>, [<span class="number">1</span>])</div></pre></td></tr></table></figure></p>
<p>It is particularly important for variables to be in the correct device in distributed settings.<br>For this reason we provide <code>tf.train.replica_device_setter</code>, which can automatically place variables in parameter servers.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">cluster_spec = &#123;</div><div class="line">    <span class="string">"ps"</span>: [<span class="string">"ps0:2222"</span>, <span class="string">"ps1:2222"</span>],</div><div class="line">    <span class="string">"worker"</span>: [<span class="string">"worker0:2222"</span>, <span class="string">"worker1:2222"</span>, <span class="string">"worker2:2222"</span>]&#125;</div><div class="line"><span class="keyword">with</span> tf.device(tf.train.replica_device_setter(cluster=cluster_spec)):</div><div class="line">  v = tf.get_variable(<span class="string">"v"</span>, shape=[<span class="number">20</span>, <span class="number">20</span>])  <span class="comment"># this variable is placed </span></div><div class="line">                                            <span class="comment"># in the parameter server</span></div><div class="line">                                            <span class="comment"># by the replica_device_setter</span></div></pre></td></tr></table></figure></p>
<h4 id="Initializing-variables"><a href="#Initializing-variables" class="headerlink" title="Initializing variables"></a>Initializing variables</h4><p>In the low-level TensorFlow API, must explicitly initialize the variables by ourselves.</p>
<ul>
<li>that is, you are explicitly creating your own graphs and sessions)</li>
</ul>
<p>Most high-level frameworks automatically initialize variables for you </p>
<ul>
<li><code>tf.contrib.slim</code>, <code>tf.estimator.Estimator</code> and <code>Keras</code></li>
</ul>
<p>Explicit initialization is otherwise useful because it </p>
<ul>
<li>allows you not to rerun potentially expensive initializers when reloading a model from a checkpoint ?</li>
<li>as well as allowing determinism when randomly-initialized variables are shared in a distributed setting.?</li>
</ul>
<p><code>tf.global_variables_initializer()</code></p>
<ul>
<li>To initialize all trainable variables</li>
<li>To be called before training starts</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">session.run(tf.global_variables_initializer())</div><div class="line"><span class="comment"># Now all variables are initialized.</span></div></pre></td></tr></table></figure>
<p>To initialize variables yourself:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">session.run(my_variable.initializer)</div></pre></td></tr></table></figure></p>
<p>ask which variables have still not been initialized:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(session.run(tf.report_uninitialized_variables()))</div></pre></td></tr></table></figure></p>
<h5 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a><em>Notice</em></h5><p>by default <code>tf.global_variables_initializer</code> does not specify the <strong>order</strong> in which variables are initialized.<br>If you use a variable’s value while initializing another variable, use <code>variable.initialized_value()</code> instead of <code>variable</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">v = tf.get_variable(<span class="string">"v"</span>, shape=(), initializer=tf.zeros_initializer())</div><div class="line">w = tf.get_variable(<span class="string">"w"</span>, initializer=v.initialized_value() + <span class="number">1</span>)</div></pre></td></tr></table></figure></p>
<h4 id="Using-variables"><a href="#Using-variables" class="headerlink" title="Using variables"></a>Using variables</h4><p>To use the value of a tf.Variable in a TensorFlow graph, simply treat it like a normal tf.Tensor.<br>To assign a value to a variable, use the methods such as <code>assign</code>, <code>assign_add</code> in the <code>tf.Variable</code> class.<br>To force a re-read of the value of a variable after something has happened, you can use tf.Variable.read_value.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">v = tf.get_variable(<span class="string">"v"</span>, shape=(), initializer=tf.zeros_initializer())</div><div class="line">assignment = v.assign_add(<span class="number">1</span>)</div><div class="line">assignment2 = v.assign_add(<span class="number">1</span>)</div><div class="line"><span class="keyword">with</span> tf.control_dependencies([assignment, assignment2]):</div><div class="line">  w = v.read_value()  <span class="comment"># w is guaranteed to reflect v's value after the</span></div><div class="line">                      <span class="comment"># assign_add operation.</span></div><div class="line"><span class="comment"># v: 0</span></div><div class="line"><span class="comment"># w: 2</span></div></pre></td></tr></table></figure></p>
<h5 id="tf-train-Optimizer"><a href="#tf-train-Optimizer" class="headerlink" title="tf.train.Optimizer"></a>tf.train.Optimizer</h5><p><a href="https://www.tensorflow.org/api_docs/python/tf/train/Optimizer" target="_blank" rel="external">https://www.tensorflow.org/api_docs/python/tf/train/Optimizer</a></p>
<h4 id="Saving-and-Restoring"><a href="#Saving-and-Restoring" class="headerlink" title="Saving and Restoring"></a>Saving and Restoring</h4><p><a href="https://www.tensorflow.org/programmers_guide/variables#saving_and_restoring" target="_blank" rel="external">https://www.tensorflow.org/programmers_guide/variables#saving_and_restoring</a></p>
<h4 id="Sharing-variables"><a href="#Sharing-variables" class="headerlink" title="Sharing variables"></a>Sharing variables</h4><p><a href="https://www.tensorflow.org/programmers_guide/variables#sharing_variables" target="_blank" rel="external">https://www.tensorflow.org/programmers_guide/variables#sharing_variables</a></p>
<h3 id="Tensors"><a href="#Tensors" class="headerlink" title="Tensors"></a>Tensors</h3><p><a href="https://www.tensorflow.org/programmers_guide/tensors" target="_blank" rel="external">https://www.tensorflow.org/programmers_guide/tensors</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/18/tf-contrib-learn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Klpek">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Klpek's Note Library">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/18/tf-contrib-learn/" itemprop="url">
                  tf.contrib.learn 阅读历程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-18T16:16:45+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/18/tf-contrib-learn/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/18/tf-contrib-learn/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="tf-contrib-learn-基本用法"><a href="#tf-contrib-learn-基本用法" class="headerlink" title="tf.contrib.learn 基本用法"></a>tf.contrib.learn 基本用法</h3><p><a href="https://www.tensorflow.org/get_started/tflearn">https://www.tensorflow.org/get_started/tflearn</a></p>
<h4 id="基本过程"><a href="#基本过程" class="headerlink" title="基本过程"></a>基本过程</h4><ol>
<li>Load file containing training/test data into a TensorFlow Dataset</li>
<li>Construct a neural network classifier</li>
<li>Fit the model using the training data</li>
<li>Evaluate the accuracy of the model</li>
<li>Classify new samples/infer work
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/08/18/tf-contrib-learn/#more" rel="contents">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Klpek" />
          <p class="site-author-name" itemprop="name">Klpek</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Powered By Klpek</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="#">Klpek</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="#">
    Ekon
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'klpek';
      var disqus_identifier = 'index.html';

      var disqus_title = "";


      function run_disqus_script(disqus_script) {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');

      

    </script>
  













  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

</body>
</html>
